---
title: "Analysis of codebook growth"
output: html_notebook
---
```{r "setup", include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(tidyverse)
```
## Preparation
Load *codings* dataset and add collumn indicating wave of data gathering.

```{r}
# TODO: waves hould already be in codings.rda

load("../data/codings.rda")
load("../data/waves.rda")

codings = codings %>% full_join(waves, by = "fid")
```

## New codes / subcodes
### Per wave

New `codename` (codes or code-subcodes) per wave:

```{r}
codings %>%
  group_by(codename) %>%
  summarise(wave = first(wave)) %>%
  group_by(wave) %>%
  summarise(n = n(), codenames = list(codename)) %>%
  rowwise() %>%
  mutate(codenames = toString(unlist(codenames))) %>%
  knitr::kable()


```
### Subcodes

New `category-code` (aggregated) per wave:

```{r}
codings %>%
  group_by(category, code) %>%
  summarise(wave = first(wave)) %>%
  group_by(wave) %>%
  summarise(n = n()) %>%
  knitr::kable()
```

### Step plot
```{r}
# TODO: labels, wave aesthetics

cum_codenames =
  codings %>%
  group_by(codename) %>%
  summarise(first_fid = first(fid)) %>%
  group_by(first_fid) %>%
  summarise(new_codenames = n(), which = list(codename)) %>%
  arrange(first_fid) %>%
  mutate(cum_new_codenames = cumsum(new_codenames)) %>%
  add_row(first_fid = max(codings$fid), cum_new_codenames = max(.$cum_new_codenames))
cum_codes =
  codings %>%
  group_by(category, code) %>%
  summarise(first_fid = first(fid)) %>%
  group_by(first_fid) %>%
  summarise(new_codes = n()) %>%
  arrange(first_fid) %>%
  mutate(cum_new_codes = cumsum(new_codes)) %>%
  add_row(first_fid = max(codings$fid), cum_new_codes = max(.$cum_new_codes))
cumulative =
  cum_codenames %>% 
  left_join(cum_codes)

cumulative %>%
  ggplot() +
  geom_step(
    aes(first_fid, cum_new_codenames)) +
  geom_step(linetype = 2,
    aes(first_fid, cum_new_codes), data = . %>% filter(! is.na(cum_new_codes)))



```
